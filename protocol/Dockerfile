FROM node:16.15-alpine

ARG INFURA_WS_URL
ARG PRIVATE_KEY
ARG POSTS_CONTRACT_ADDRESS
ARG FEES_COLLECTOR_ADDRESS
ARG PINATA_PRIVATE_KEY
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_BUCKET

ENV INFURA_WS_URL=${INFURA_WS_URL}
ENV PRIVATE_KEY=${PRIVATE_KEY}
ENV POSTS_CONTRACT_ADDRESS=${POSTS_CONTRACT_ADDRESS}
ENV FEES_COLLECTOR_ADDRESS=${FEES_COLLECTOR_ADDRESS}
ENV PINATA_PRIVATE_KEY=${PINATA_PRIVATE_KEY}
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV AWS_BUCKET=${AWS_BUCKET}

RUN mkdir code

COPY . /code

RUN npm install --global yarn

WORKDIR /code

RUN yarn

RUN yarn bot:posts:pm2
